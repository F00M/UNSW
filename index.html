<!DOCTYPE html><html lang="id"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>UNISWOP v6.4 ‚Ä¢ Sepolia</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
:root{--bg:#0e101b;--panel:#151b2c;--b:#202a40;--txt:#fafafa;--sub:#9ca3af;--p1:#ff4ecd;--p2:#ff007a}
*{box-sizing:border-box}body{margin:0;background:radial-gradient(circle at 20% -10%,#1b1230,#0e101b);
font-family:Inter,sans-serif;color:var(--txt);display:flex;justify-content:center;align-items:center;min-height:100vh}
.app{width:min(430px,94vw)}.head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.brand{font-weight:800;font-size:20px;background:linear-gradient(90deg,var(--p1),var(--p2));
-webkit-background-clip:text;-webkit-text-fill-color:transparent}.btn{border:0;border-radius:10px;
padding:9px 14px;background:linear-gradient(90deg,var(--p1),var(--p2));color:#fff;font-weight:700;cursor:pointer}
.card{background:#101523;border:1px solid var(--b);border-radius:14px;padding:16px}
.sel{display:flex;justify-content:space-between;align-items:center;background:#0b0f18;border:1px solid var(--b);
border-radius:12px;padding:12px;margin:6px 0}select,input{background:transparent;border:0;color:#fff;font-size:17px;font-weight:700;outline:none}
input{text-align:right;width:55%}.flip{border:1px solid var(--b);background:#121826;border-radius:50%;width:34px;height:34px;color:#fff;cursor:pointer}
.small{font-size:12px;color:var(--sub)}.pre{background:#0b0f18;border:1px solid var(--b);border-radius:10px;
padding:8px;font-size:12px;color:#b6c6ff;max-height:180px;overflow:auto;margin-top:8px}
.add{border:1px solid var(--b);background:none;color:#fff;border-radius:50%;width:30px;height:30px;font-size:16px;cursor:pointer}
.addIn{display:none;width:100%;padding:8px;border:1px solid var(--b);border-radius:8px;background:#0b0f18;color:#fff;margin-top:6px}
</style></head><body><div class="app">
<div class="head"><div class="brand">ü¶Ñ UNISWOP</div><div style="display:flex;gap:6px;align-items:center">
<button id="add" class="add">‚ûï</button><button id="connect" class="btn">Connect</button></div></div>
<div class="card">
<input id="addIn" class="addIn" placeholder="Tempel contract ERC20 lalu Enter"/>
<div class="sel"><select id="a"></select><input id="va" placeholder="0.0"/></div>
<div class="small" id="ba">Balance -</div>
<div style="text-align:center;margin:8px"><button id="flip" class="flip">‚áÖ</button></div>
<div class="sel"><select id="b"></select><input id="vb" placeholder="0.0" disabled/></div>
<div class="small" id="bb">Balance -</div>
<button id="swap" class="btn" style="width:100%;margin-top:10px">Swap</button>
<div class="small" id="rate">Estimasi -</div><pre id="log">log siap‚Ä¶</pre></div></div>
<script>
const CHAIN={id:11155111,hex:"0xaa36a7",exp:"https://sepolia.etherscan.io"};
const ROUTERS=["0xeE567Fe1712Faf6149d80dA1E6934E354124CfE3","0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b"];
let TOK=[{s:"ETH",a:"ETH_NATIVE",d:18},{s:"WETH",a:"0xfff9976782d46cc05630d1f6ebab18b2324d6b14",d:18},{s:"USDC",a:"0x1c7d4b196cb0c7b01d743fbc6116a902379c7238",d:6}],
P,S,M;const $=i=>document.getElementById(i),L=m=>{let e=$("log");e.textContent+=(e.textContent?"\n":"")+m;e.scrollTop=e.scrollHeight};
const ERC20=["function symbol()view returns(string)","function decimals()view returns(uint8)","function balanceOf(address)view returns(uint)",
"function allowance(address,address)view returns(uint)","function approve(address,uint)returns(bool)"],
ROUT=["function getAmountsOut(uint,address[])view returns(uint[])","function swapExactTokensForTokens(uint,uint,address[],address,uint)",
"function swapExactETHForTokens(uint,address[],address,uint)payable","function swapExactTokensForETH(uint,uint,address[],address,uint)"],
WETH=["function deposit()payable","function withdraw(uint)"];
function refSel(){["a","b"].forEach(i=>{let s=$(i);s.innerHTML="";TOK.forEach((t,k)=>s.add(new Option(t.s,k)));})}
refSel();
async function prov(){if(!window.ethereum)throw Error("Install MetaMask");if(!P)P=new ethers.providers.Web3Provider(window.ethereum,"any")}
$("connect").onclick=async()=>{try{await prov();await P.send("eth_requestAccounts",[]);S=P.getSigner();M=await S.getAddress();let n=await P.getNetwork();
if(n.chainId!==CHAIN.id)await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:CHAIN.hex}]});
$("connect").textContent=M.slice(0,6)+"‚Ä¶"+M.slice(-4);L("‚úÖ Connected");bal();}catch(e){L("‚ùå "+e.message)}}
$("add").onclick=()=>$("addIn").style.display=$("addIn").style.display==="none"?"block":"none";
$("addIn").onkeypress=e=>{if(e.key==="Enter")addT(e.target.value.trim())}
async function addT(a){try{if(!/^0x[0-9a-fA-F]{40}$/.test(a))throw Error("Addr invalid");await prov();let c=new ethers.Contract(a,ERC20,P);
let s="TKN",d=18;try{s=await c.symbol();d=await c.decimals();}catch{}TOK.push({s,a,d:+d});refSel();$("addIn").style.display="none";L("‚úÖ Token "+s);}catch(e){L("‚ùå Add "+e.message)}}
async function bal(){try{const t=i=>TOK[i],b=async x=>{if(x.a==="ETH_NATIVE")return ethers.utils.formatUnits(await P.getBalance(M),x.d);
return ethers.utils.formatUnits(await(new ethers.Contract(x.a,ERC20,P)).balanceOf(M),x.d)};
let [A,B]=[t(+$("a").value),t(+$("b").value)];[$("ba").textContent,$("bb").textContent]=[`Bal: ${(+await b(A)).toFixed(4)} ${A.s}`,`Bal: ${(+await b(B)).toFixed(4)} ${B.s}`]}catch{}}
function sNum(v){v=(v||"").replace(/,/g,"");return /^\d*\.?\d*$/.test(v)?v:""}function pU(v,d){return ethers.utils.parseUnits(sNum(v)||"0",d)}
function path(){const A=TOK[+$("a").value],B=TOK[+$("b").value];const w=TOK[1].a;return[(A.a==="ETH_NATIVE"?w:A.a),(B.a==="ETH_NATIVE"?w:B.a)]}
async function est(){try{const ta=TOK[+$("a").value],tb=TOK[+$("b").value];const v=sNum($("va").value);if(!v||ta===tb)return $("rate").textContent="Estimasi -";
let r=new ethers.Contract(ROUTERS[0],ROUT,P);const out=(await r.getAmountsOut(pU(v,ta.d),path())).pop();const h=Number(ethers.utils.formatUnits(out,tb.d));
$("vb").value=h.toFixed(6);$("rate").textContent=`1 ${ta.s} ‚âà ${(h/+v).toFixed(6)} ${tb.s}`;}catch{$("vb").value="";$("rate").textContent="Estimasi gagal"}}
["a","b"].forEach(i=>$(i).onchange=()=>{bal();est();});$("va").oninput=()=>{ $("va").value=sNum($("va").value);est();};
$("flip").onclick=()=>{[$("a").value,$("b").value]=[$("b").value,$("a").value)];[$("va").value,$("vb").value]=[$("vb").value,$("va").value];bal();est();};
async function allow(t,v,r){let c=new ethers.Contract(t,ERC20,S),al=await c.allowance(M,r);if(al.gte(v))return;let x=await c.approve(r,v);L("üßæ Approve "+x.hash);await x.wait()}
async function wrap(v){let w=new ethers.Contract(TOK[1].a,WETH,S);let x=await w.deposit({value:v});L("Wrap "+x.hash);await x.wait()}
async function unwrap(v){let w=new ethers.Contract(TOK[1].a,WETH,S);let x=await w.withdraw(v);L("Unwrap "+x.hash);await x.wait()}
$("swap").onclick=async()=>{try{await prov();if(!S)await $("connect").onclick();let ta=TOK[+$("a").value],tb=TOK[+$("b").value];const val=sNum($("va").value);
if(!val||ta===tb)throw Error("Input invalid");const amt=pU(val,ta.d);
if(ta.s==="ETH"&&tb.s==="WETH")return await wrap(amt);if(ta.s==="WETH"&&tb.s==="ETH")return await unwrap(amt);
const pathx=path(),dl=Math.floor(Date.now()/1e3)+1200;
for(const rA of ROUTERS){try{let r=new ethers.Contract(rA,ROUT,S);let out=(await r.getAmountsOut(amt,pathx)).pop(),min=out.mul(9950).div(10000),x;
if(ta.a==="ETH_NATIVE")x=await r.swapExactETHForTokens(min,pathx,M,dl,{value:amt});
else if(tb.a==="ETH_NATIVE"){await allow(ta.a,amt,rA);x=await r.swapExactTokensForETH(amt,min,pathx,M,dl);}
else{await allow(ta.a,amt,rA);x=await r.swapExactTokensForTokens(amt,min,pathx,M,dl);}
L("TX "+x.hash);await x.wait();L("‚úÖ Swap OK");bal();return;}catch(e){L("‚ö†Ô∏è Router fail "+e.message)}}throw Error("Semua router gagal")}
catch(e){L("‚ùå "+(e.data?.message||e.message))}};
</script></body></html>
